TODO: use px buffers for the manipulations


